<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/@zumer/snapdom/dist/snapdom.min.js"></script>

    <title>Search3958</title><link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="icon" href="https://search3958.github.io/icons/search3958.svg">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Albert+Sans:wght@100..900&family=Noto+Sans+JP:wght@100..900&family=Unbounded:wght@200..900&display=swap" rel="stylesheet">
    <script type="importmap">
    {
      "imports": {
        "@material/web/": "https://esm.run/@material/web/"
      }
    }
  </script>
  <script type="module">
    import '@material/web/all.js';
    import {styles as typescaleStyles} from '@material/web/typography/md-typescale-styles.js';

    document.adoptedStyleSheets.push(typescaleStyles.styleSheet);
  </script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Albert Sans","Zen Kaku Gothic New",sans-serif;
            line-height: 1.5;
        }
        :root{
          --md-ripple-hover-color:#0000;
          --header-width: 279px;
    --header-expanded-width: 279px;
          --section-raius:64px;
          --mac-color:#fff;
        }

        #lensFx_canvas {
            position: fixed;
            top: 24px;
  left: 50%;
  transform: translateX(-50%);
            width: var(--header-width);
            height: 80px;
            border-radius: 40px;
            z-index: 10;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    --smooth-corners: 8,3;
  mask-image: paint(smooth-corners);
  -webkit-mask-image: paint(smooth-corners);
  
        }
        .header {
            position: fixed;
            top: 24px;
  left: 50%;
  transform: translateX(-50%);
            width: var(--header-width);
            height: 80px;
            border-radius: 40px;
            z-index: 11;
            transition: all 0.6s cubic-bezier(.2,0,0,1);
            background: #aaa;
            backdrop-filter: blur(4px);
            gap: 16px;
            padding: 0 16px;
    mix-blend-mode: overlay;
    --smooth-corners: 8,3;
  mask-image: paint(smooth-corners);
  -webkit-mask-image: paint(smooth-corners);
        }

        .header-ctn {
            position: fixed;
            top: 24px;
  left: 50%;
  transform: translateX(-50%);
            width: var(--header-width);
            height: 80px;
            border-radius: 40px;
            z-index: 12;
            background: none;
            display: flex;
            flex-wrap: nowrap;
            white-space: nowrap;
            align-items: center;
            gap: 16px;
            padding: 0 16px;
            background:#fff6;
   box-shadow: 0px 8px 32px 0px rgba(0, 0, 0, 0.22);
        }

        .section{
          background:#FFFFFF;
            padding:32px;
          position:relative;
          color:#000;
            border-radius: var(--section-raius);
            margin:10px;
            --smooth-corners: 3,3;
  mask-image: paint(smooth-corners);
  -webkit-mask-image: paint(smooth-corners);
        }

footer{
 padding:40px;
 background:#fff;
 padding-bottom:80px;
            --smooth-corners: 1;
  mask-image: paint(smooth-corners);
  -webkit-mask-image: paint(smooth-corners);
          font-family: "Unbounded", sans-serif;
          color:#A0A7AE;
          text-align: center;
}
.footer{
  height:104px;
  overflow:hidden;
}

.img{
  height:160px;
  width:255px;
  border-radius:24px;
  margin-bottom:8px;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
}
.btns{
  width:255px;
  display:flex;
  gap:8px;
  height:48px;
}
#copy,#download,#setNewtab{
  width:50%;
  border-radius:24px;
  padding:8px 0px;
  border:none;
  position:relative;
  background: #f6eddf;
  box-shadow: inset 0px -13px 16px -4px #6c543423, 0px 6px 24px 0px rgba(0, 0, 0, 10%);
  color:#000;
}
#setNewtab{
  width:100%;
  background: #FF7700;
  box-shadow: inset 0px -13px 16px -4px #ba2500, 0px 6px 24px 0px rgba(0, 0, 0, 10%);
  color:#fff;
}
.container{
  display:flex;
  gap:20px;
  width:calc(100% - 40px);
  overflow:scroll;
  background-color: #fffef89e;
  border-radius:44px;
  padding:20px;
  margin-bottom:16px;
  box-shadow: 0px 6px 24px 0px rgba(0, 0, 0, 10%);
}
.h3{
  font-size:24px;
  margin-bottom:8px;
}
.h2{
  font-size:32px;
 position:relative;
  bottom:4px;
}
    </style>
</head>
<body>

    <canvas id="lensFx_canvas" data-html2canvas-ignore="true"></canvas>
<div class="header" data-html2canvas-ignore="true">
</div>

<div class="header-ctn" data-html2canvas-ignore="true">
  <button class="header-toggle" onclick="window.location.href='https://search3958.github.io/'"> 

<svg xmlns="http://www.w3.org/2000/svg" width="10" height="13" viewBox="0 0 10 13" fill="none">
<path d="M0.68103 4.55652C0.68103 2.17122 2.6147 0.237549 5 0.237549C7.3853 0.237549 9.31897 2.17122 9.31897 4.55652C9.31897 6.94182 7.3853 8.87549 5 8.87549C2.6147 8.87549 0.68103 6.94182 0.68103 4.55652Z" fill="url(#paint0_radial_547_63)"/>
<foreignObject x="-3.31897" y="0.124512" width="16.6379" height="16.6379"><div xmlns="http://www.w3.org/1999/xhtml" style="clip-path:url(#bgblur_0_547_63_clip_path);height:100%;width:100%"></div></foreignObject><path data-figma-bg-blur-radius="4" d="M0.68103 8.44348C0.68103 6.05818 2.6147 4.12451 5 4.12451C7.3853 4.12451 9.31897 6.05818 9.31897 8.44348C9.31897 10.8288 7.3853 12.7625 5 12.7625C2.6147 12.7625 0.68103 10.8288 0.68103 8.44348Z" fill="url(#paint1_radial_547_63)"/>
<defs>
<clipPath id="bgblur_0_547_63_clip_path" transform="translate(3.31897 -0.124512)"><path d="M0.68103 8.44348C0.68103 6.05818 2.6147 4.12451 5 4.12451C7.3853 4.12451 9.31897 6.05818 9.31897 8.44348C9.31897 10.8288 7.3853 12.7625 5 12.7625C2.6147 12.7625 0.68103 10.8288 0.68103 8.44348Z"/>
</clipPath><radialGradient id="paint0_radial_547_63" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(5 8.87549) rotate(-90) scale(9.57372 9.57372)">
<stop stop-color="#0000"/>
<stop offset="1" stop-color="#0009"/>
</radialGradient>
<radialGradient id="paint1_radial_547_63" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(5 12.7625) rotate(-90) scale(9.57372 9.57372)">
<stop stop-color="#545454"/>
<stop offset="1" stop-color="#0003"/>
</radialGradient>
</defs>
</svg>

  </button>
  <a class="hda" href="https://search3958.github.io/">概要</a>
  <a class="hda" href="https://search3958.github.io/i/newtab/">Newtab</a>
  <a class="hda" href="https://search3958.github.io/i/tools/">ツール</a>
</div>


<div class="h3">サークル</div>
<div class="container">
  <img-btns image-url="circle1.webp"></img-btns>
  <img-btns image-url="circle2.webp"></img-btns>
  <img-btns image-url="circle3.webp"></img-btns>
  <img-btns image-url="circle4.webp"></img-btns>
  <img-btns image-url="circle5.webp"></img-btns>
  <img-btns image-url="circle6.webp"></img-btns>
  <img-btns image-url="circle7.webp"></img-btns>
  <img-btns image-url="circle8.webp"></img-btns>
  <img-btns image-url="circle9.webp"></img-btns>
  <img-btns image-url="circle10.webp"></img-btns>
</div>

<script>
  const lensFx_canvas = document.getElementById("lensFx_canvas");
  const lensFx_ctx = lensFx_canvas.getContext("2d");
  const debugInfo = document.getElementById("debugInfo");

  const LAYERS = 13;
  const MIN_ZOOM = 1.8;
  const MAX_ZOOM = 1;
  const SHRINK_STEP = 5.5;
  const CAPTURE_INTERVAL = 100;
  const SCROLL_CAPTURE_INTERVAL = 5000;

  let lensFx_img = null;
  let scrollOffsetY = 0;
  let captureTimer = null;
  let autoUpdate = true;
  let showDebug = false;
  let isScrolling = false;
  let scrollTimeout = null;

  function safeInverseEasing(t) {
    const ε = 0.05;
    const v = 1 / (t + ε) - 1 / ε;
    const maxV = 1 / (1 + ε) - 1 / ε;
    return v / maxV;
  }

  function radiusEasing(t) {
    return 0.3 + 0.7 * (1 - t * t);
  }

  function updateCanvasSize(canvas, ctx) {
    const rect = canvas.getBoundingClientRect();
    const dpr = window.devicePixelRatio || 1;
    canvas.width = rect.width * dpr;
    canvas.height = rect.height * dpr;
    ctx.setTransform(1, 0, 0, 1, 0, 0);
    ctx.scale(dpr, dpr);
  }

  function getRadius(canvas) {
    return parseFloat(getComputedStyle(canvas).borderRadius) || 0;
  }

  function drawLens(img, ctx, canvasElem) {
    if (!img) return;

    const imgW = img.width;
    const imgH = img.height;
    const rect = canvasElem.getBoundingClientRect();
    const wLens = rect.width;
    const hLens = rect.height;
    const radius = getRadius(canvasElem);

    const canvasScreenX = rect.left;
    const canvasScreenY = rect.top + scrollOffsetY;

    const viewportW = window.innerWidth;
    const viewportH = document.documentElement.scrollHeight;

    const scaleX = imgW / viewportW;
    const scaleY = imgH / viewportH;

    const imgCenterX = (viewportW / 2) * scaleX;
    const imgCenterY = canvasScreenY * scaleY + (hLens / 2) * scaleY;

    ctx.clearRect(0, 0, canvasElem.width, canvasElem.height);

    if (showDebug) {
      debugInfo.innerHTML =
        `Canvas位置: (${canvasScreenX.toFixed(0)}, ${canvasScreenY.toFixed(0)})<br>
        画像サイズ: ${imgW} x ${imgH}<br>
        ビューポート: ${viewportW} x ${viewportH}<br>
        スケール: ${scaleX.toFixed(3)} x ${scaleY.toFixed(3)}<br>
        画像上中心: (${imgCenterX.toFixed(0)}, ${imgCenterY.toFixed(0)})`;
    }

    for (let i = 0; i < LAYERS; i++) {
      const t = i / (LAYERS - 1);
      const zoom = MIN_ZOOM + safeInverseEasing(t) * (MAX_ZOOM - MIN_ZOOM);
      const w = wLens - i * SHRINK_STEP;
      const h = hLens - i * SHRINK_STEP;
      const dx = (wLens - w) / 2;
      const dy = (hLens - h) / 2;

      const sw = (w / zoom) * scaleX;
      const sh = (h / zoom) * scaleY;
      const sx = imgCenterX - sw / 2;
      const sy = imgCenterY - sh / 2;

      const rad = radius * radiusEasing(t);

      ctx.save();
      ctx.beginPath();
      ctx.moveTo(dx + rad, dy);
      ctx.lineTo(dx + w - rad, dy);
      ctx.quadraticCurveTo(dx + w, dy, dx + w, dy + rad);
      ctx.lineTo(dx + w, dy + h - rad);
      ctx.quadraticCurveTo(dx + w, dy + h, dx + w - rad, dy + h);
      ctx.lineTo(dx + rad, dy + h);
      ctx.quadraticCurveTo(dx, dy + h, dx, dy + h - rad);
      ctx.lineTo(dx, dy + rad);
      ctx.quadraticCurveTo(dx, dy, dx + rad, dy);
      ctx.closePath();
      ctx.clip();

      ctx.drawImage(img, sx, sy, sw, sh, dx, dy, w, h);
      ctx.restore();
    }
  }

  function renderAll() {
    updateCanvasSize(lensFx_canvas, lensFx_ctx);
    drawLens(lensFx_img, lensFx_ctx, lensFx_canvas);
  }

  async function captureFullPage() {
    try {
      const fullW = document.documentElement.scrollWidth;
      const fullH = document.documentElement.scrollHeight;
      const svg = await snapdom(document.body, {
        width: fullW,
        height: fullH,
        scale: 1,
        scrollX: 0,
        scrollY: 0,
        backgroundColor: null
      });

      const img = new Image();
      img.onload = () => {
        lensFx_img = img;
        renderAll();
      };
      img.src = svg;
    } catch (e) {
      console.error(e);
    }
  }

  function updateLensEffect() {
    captureFullPage();
  }

  function toggleAutoUpdate() {
    autoUpdate = !autoUpdate;
    if (autoUpdate) {
      captureTimer = setInterval(captureFullPage, CAPTURE_INTERVAL);
    } else {
      clearInterval(captureTimer);
    }
  }

  function toggleDebug() {
    showDebug = !showDebug;
    debugInfo.style.display = showDebug ? 'block' : 'none';
    if (showDebug) {
      renderAll();
    }
  }

  captureFullPage();
  updateCaptureTimer();

  window.addEventListener("scroll", () => {
    scrollOffsetY = window.scrollY;
    renderAll();

    isScrolling = true;
    clearTimeout(scrollTimeout);
    clearInterval(captureTimer);
    updateCaptureTimer();

    scrollTimeout = setTimeout(() => {
      isScrolling = false;
      updateCaptureTimer();
    }, 150);
  });

  function updateCaptureTimer() {
    if (captureTimer) {
      clearInterval(captureTimer);
      captureTimer = null;
    }
    if (autoUpdate) {
      const interval = isScrolling ? SCROLL_CAPTURE_INTERVAL : CAPTURE_INTERVAL;
      captureTimer = setInterval(captureFullPage, interval);
    }
  }

  window.addEventListener("resize", renderAll);

  const header = document.querySelector('.header');
  let isExpanded = false;

  function syncWidth() {
    lensFx_canvas.style.width = `${header.offsetWidth}px`;
    renderAll();
  }

  if (window.ResizeObserver) {
    const resizeObserver = new ResizeObserver(() => {
      syncWidth();
    });

    resizeObserver.observe(header);
    resizeObserver.observe(lensFx_canvas);
  }

  const mutationObserver = new MutationObserver(() => {
    syncWidth();
  });

  mutationObserver.observe(header, {
    attributes: true,
    attributeFilter: ['style']
  });

  syncWidth();

  const headerToggle = document.querySelector('.header-toggle');

  headerToggle.addEventListener('click', () => {
    header.classList.toggle('active');
    syncWidth();
  });
</script>


<script>
function updateSmoothCorners() {
  // 対象: .smooth クラスを持つ要素
  const elements = document.querySelectorAll('.smooth');

  elements.forEach(el => {
    // 現在の computed style で --smooth-corners が使われているかチェック
    const style = getComputedStyle(el);
    const hasSmoothCorners = style.getPropertyValue('--smooth-corners');

    if (hasSmoothCorners !== '') {
      const height = el.offsetHeight;
      const width = el.offsetWidth;
      const smoothValue = `${(width / 50).toFixed(2)}, ${(height / 50).toFixed(2)}`;
      el.style.setProperty('--smooth-corners', smoothValue);
    }
  });
}

// 初回実行
updateSmoothCorners();

// ウィンドウサイズ変更時にも再計算
window.addEventListener('resize', updateSmoothCorners);

// DOM追加時にも対応（必要なら）
const observer = new MutationObserver(updateSmoothCorners);
observer.observe(document.body, { childList: true, subtree: true });
</script>
<script>
  if (CSS && 'paintWorklet' in CSS) CSS.paintWorklet.addModule('https://unpkg.com/smooth-corners')
</script>
  <script  src="./script.js"></script>

<div class="footer">
<footer class="smooth">
  © Search 3958
</footer>
</div>

</body>
</html>